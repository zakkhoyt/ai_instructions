

Create a script (./configure_ai_instructions.zsh) to help install these ai instructions to a specific folder for a specific AI service. 

Terms:
* `repo_dir` - this repository's root directory (as cloned on the user's computer)
* `repo_instructions_dir` (`$repo_dir/instructions`) - this repository's directory where instructions are located
* `user_ai_dir` - A user level directory that will contains the "source of truth"
* `user_ai_instructions_dir` - a sub dir of `user_ai_dir` where the instructions are kept (`$user_ai_dir/instructions`)
* `target_dir` - the directory to configure AI instructions for.
* `<AI TODO>` - TODO task for AI agent to look up details on the internet


Args:
* --source-dir <dir>: (let's call this var `user_ai_dir`). 
  * If not passed as arg, check environment variable `Z2K_AI_DIR` before defaulting to `$HOME/.ai`

* --target-dir <path> : (let's call this var `target_dir`) Specify the directory to configure AI instructions for.
  * default: PWD
  * this must also be a root directory of a git repository. 
  * Ask git for the root dir then compare
    * log a warning if no git repository is found
    * log a warning if target_dir != git_root_dir
* --ai-platform <platform> : (let's call this var `ai_platform`) Specify the AI platform to configure instructions for.
  * valid options: 
    "copilot" aka "github-copilot", "github"
    "claude"
    "cursor"
    "coderabbit"
  * default: "copilot"
* --configure-type <copy | symlink> : (let's call this var `configure_type`) Specify whether to copy or symlink the instructions.
  * valid options: "copy", "symlink"
  * default: "symlink"

# Prepare
* init var `target_instructions_dir` from ai_platform
  * copilot: "$target_dir/.github/instructions"
  * claude: "$target_dir/.claude/settings.json"
  * cursor: "$target_dir/.cursor/rules/mobile.mdc"
  * coderabbit: <AI TODO>

* init var `ai_platform_instruction_file` from ai_platform
  * copilot: "$target_dir/.github/copilot-instructions.md"
  * claude: "$target_dir/.claude/settings.json"
  * cursor: "$target_dir/.cursor/rules/mobile.mdc"
  * coderabbit: <AI TODO>

* init var `ai_instruction_settings_file` from ai_platform
  * copilot: "$ai_platform_instruction_file"
  * cursor: "$ai_platform_instruction_file"
  * claude: "$target_dir/CLAUDE.md"
  * coderabbit: <AI TODO>
  


* create `$user_ai_instructions_dir` if needed
* Force copy this repository to `$user_ai_instructions_dir`  which will serve as the source of truth

* create `$target_instructions_dir` if needed
* read the contents of `$target_instructions_dir`. We will need a ways to compare existing instructions to those in `$repo_dir/instructions` to denote if they the source instructions have been updated since last linked. git diff? checksum?

* Present a menu to the user to select which instructions to "configure"
  * this menu should list reflect all files in `$user_ai_instructions_dir`
  * The menu should visually indicate which instructions are already installed in the target directory.
  * If configure_type == "copy", then the menu will need to indicate (for installed instructions) whether the source file has been updated since last copy.
  * the contents of the menu should be dynamically generated by listing all files in `$user_ai_instructions_dir`
  * The menu should visually indicate which instructions are already installed, but where the source file has been updated since last copy (if configure_type == "copy")

* For each selected instruction, "install" the file according to `configure_type`
    * if `configure_type` == "symlink", then create a symlink from `$user_ai_instructions_dir/<file>` to `$target_instructions_dir/<file>`
    * if `configure_type` == "copy", then copy the file from `$user_ai_instructions_dir/<file>` to `$target_instructions_dir/<file>`

---

# TODO / Additions

## Support development of this repo along side the target repo
* add a new cli flag: `--link-to-ai-dir`
* if set, then create a symlink to `$user_ai_dir` in `$target_dir1`
```zsh
# I think this is the correct command
ln -s $user_ai_dir $target_dir1
```
  

* [X] ~~*if `$target_dir1` contains a vscode-workspace file, modify it as if we had the VSCOde IDE open and "add folder to workspace"*~~ [2025-11-02]
* [X] ~~*if `$target_dir1` contains a .gitignore file, modify it to ignore the symlink created ^*~~ [2025-11-02]
* [ ] The above turns out to be redundant so let's break ^ into two args
1. --dev-link: create the symlink and update .gitignore
2. --dev-vscode: add folder to workspace


---
<!-- 

when prsenting the menu to the user, where it is detected that some files have already been linked/copied

(like this)
```zsh
 1. [S] markdown-conventions.instructions.md
file_status=symlinked
status_indicator='[S]'
 2. [ ] swift-conventions.instructions.md
file_status=not_installed
status_indicator='[ ]'
 3. [S] zsh-conventions.instructions.md
```

pre-enter those already installed files into stdin (type it on behalf of the user, but dont' press enter)

EX:
In this case
```zsh
1 3
```

This way the user has only to press enter to update the files/links -->



---

# `.github/copilot-instructions.md`
The configure script should also (optionally) either generate, copy, or link to `.github/copilot-instructions.md`


* [ ] New arg to add custom specs to:
  * [ ] `--dev-link`: Add additional `[--dev-link-name <dir_name>]` which has a default value of the last path component of `$user_ai_dir`. When creating the symlink, use this value for the directory name of the sym link. This allows the user to control what the sym link directory name is in their repo
  * [ ] `--dev-vscode`: : Add additional `[--dev-vscode-name <dir_name>]` which has a default value of the last path component of `$user_ai_dir`. When creating the folder name in VSCode, use this value for the folder name. This allows the user to control what the sym link directory name is in their repo





<!-- 

The script `scripts/configure_ai_instructions.zsh` is mostly working as expected. I've noticed some problems with the `--dev-vscode` arg. It's not quite working as expected. 

* should modify the first *.code-workspace file found. 
  * If none are found, print that none were found then move on without modifying the workspace
  * If multiple are found, prompt the user which to use
  * if only 1 found, modify that one. 
* When adding the dir to the workspace file, the `"path"` to `$user_ai_dir` should be absolute, if possible.  (in the example below it's relative: `"../../../../../.ai"`)
* The `"name"` property should be set along side `"path"`, and it should be set it should be set to the the last path compontent of `$user_ai_dir` is. In this example it should be `.ai`
* This script should be smart enough to detect if `user_ai_dir` has already been added to the workspace, then print as much and be done with this step. 

## Example 01
The workspace file `userscripts.code-workspace` was updated using `cd $HOME/code/repositories/z2k/github/userscripts && ~/.ai/scripts/configure_ai_instructions.zsh --dev-vscode --debug`

See a capture of the terminal I/O here: `scripts/.gitignored/bug01.log`

This is the diff of that at file after running the script

* Problem 1: The path to `$user_ai_dir` is completely wrong.
  * PWD is `$HOME/code/repositories/z2k/github/userscripts`
  * the relavite path to `$user_ai_dir` is `"path": "../../../../../.ai"`, not `.ai`. Like it's computing what should be `name` and putting it in `path`
* Problem 2: If the path property were correct, it should be absolute path (if possible)
  * Ideally: `$HOME/.ai`, falling back to `~/.ai`, falling back to `/Users/zakkhoyt/.ai`
* Problem 3: The name property is wrong. It should always be the leaf dir name of `path` (or `$user_ai_dir`). Never `"AI Documentation"`

```diff
   "folders": [
     {
       "path": "."
+    },
+    {
+      "path": ".ai",
+      "name": "AI Documentation"
     }
   ],
   "settings": {}
```
Ideal diff
```diff
   "folders": [
     {
       "path": "."
+    },
+    {
+      "path": "/Users/zakkhoyt/.ai",
+      "name": ".ai"
     }
   ],
   "settings": {}
```
 -->



